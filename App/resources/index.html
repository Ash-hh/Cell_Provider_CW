<!DOCTYPE html>
<html>
    <head>
        <title>
            register
        </title>
        <style>
            #popup{
                width:100%;
                min-height:100%;
                background-color: rgba(0,0,0,0.5);
                overflow:hidden;
                position:fixed;
                top:0px;
                visibility: hidden;
             
            }
            #popup #popup_content{
                margin:40px auto 0px auto;
                width:420px;
                height: 90px;
                padding:10px;
                background-color: #c5c5c5;
                border-radius:5px;
                box-shadow: 0px 0px 10px #000;
            }    
        </style>
        <script>

            function PopUpHide(){
                popup.style.visibility = "hidden";               
            }
        
            function PopUpShow(id){
                fetch(`http://localhost:5000/api/findbyid/FindTariff/${id}`)
                .then(result=>{
                    return result.json();
                }).then(data=>{
                    popup_content.innerHTML=`
                        <p>${data.Description} ${data.Call_Cost_perm}</p>
                        <input type="button" value="submit" onclick="numSubmit(${data.Tariff_Id})">
                    `
                })

                popup.style.visibility = "visible" 
            }

            function onloadTariffs(){

                let refconfig = 'http://localhost:5000';

                fetch('http://localhost:5000/api/all/AllTariffs')
                .then(response=>{
                    console.log(response.headers.get('Content-Type'));
                    return response.json();
                })
                .then((data)=>{                    
                    data.forEach(element => {
                        Tariffs.innerHTML+=`
                        <tr> 
                            <td>${element.Description}</td> 
                            <td>${element.Call_Cost_perm}</td> 
                            <td>    
                                <button
                                    id=${element.Tariff_Id}"
                                    onclick="PopUpShow(this.id)">
                                Get Tariff</button> 
                                
                            </td>
                        </tr>`;
                    });
                   
                })
            }

            function GetUser(){
                fetch('http://localhost:5000/api/findbyid/FindUser/cookie')
                .then(response=>{
                    if(response.ok){
                        return response.json();
                    }    
                    else{
                        return 0;
                    }
                })
                .then((data)=>{   
                                 
                    if(!data){
                      header.innerHTML+=`
                      <a href='http://localhost:5000/login'>Log In</a> 
                      <a href='http://localhost:5000/register'>register</a>`
                    } else {
                       
                        header.innerHTML+=`
                      <a href='http://localhost:5000/profile/${data.Login}'>profile</a>
                      <a href='http://localhost:5000/logout'>log out</a>`
                      if(data.User_Type == 1){
                        header.innerHTML+=`
                        <a href='http://localhost:5000/Admin/main'>Admin</a>`
                      }
                      
                    }
                })
            }

            function load(){
                onloadTariffs();
                GetUser();
            }

            function numSubmit(id){
           
                fetch(`/subtariff?id=${id}`,{
                    method:"POST"
                }).then(result=>{
                    return result.text();
                }).then(data=>{
                    alert(data);
                })

                PopUpHide();
            }
        </script>
    </head>
    <body onload="load()">      
       <header id="header">
          
       </header>
       <div>
            <div id="popup">
                <div id="popup_content">
                    
                </div>
            </div>
           <table id="Tariffs">
               <tr>
                   <td>Description</td>
                   <td>Call Cost</td>
               </tr>
           </table>
       </div>
    </body>
    
</html>